<script type="module">
    import * as THREE from 'three';
    import { OBJLoader } from 'three/addons/loaders/OBJLoader.js';
    import { MTLLoader } from 'three/addons/loaders/MTLLoader.js';

    // --- СЦЕНА И СВЕТ (ДЕНЬ) ---
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x87CEEB);
    scene.fog = new THREE.Fog(0x87CEEB, 10, 150);

    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.shadowMap.enabled = true;
    document.body.appendChild(renderer.domElement);

    const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
    scene.add(ambientLight);

    const sunLight = new THREE.DirectionalLight(0xffffff, 1.0);
    sunLight.position.set(50, 100, 50);
    sunLight.castShadow = true;
    scene.add(sunLight);

    // --- ЗАГРУЗЧИК ---
    const objLoader = new OBJLoader();
    const mtlLoader = new MTLLoader();

    function loadModel(path, name, pos, scale = 1) {
        mtlLoader.setPath(path);
        mtlLoader.load(name + '.mtl', (mtl) => {
            mtl.preload();
            objLoader.setMaterials(mtl);
            objLoader.setPath(path);
            objLoader.load(name + '.obj', (obj) => {
                obj.position.copy(pos);
                obj.scale.setScalar(scale);
                obj.rotation.y = Math.random() * Math.PI * 2; // Случайный поворот для естественности
                obj.traverse(n => { if(n.isMesh) { n.castShadow = true; n.receiveShadow = true; }});
                scene.add(obj);
            });
        });
    }

    // --- РАССТАНОВКА ОБЪЕКТОВ ---

    // 1. Костер в центре
    loadModel('models/models_game/', 'bonfire', new THREE.Vector3(0, 0, 0), 1.2);
    const fireLight = new THREE.PointLight(0xff6600, 2, 10);
    fireLight.position.set(0, 1, 0);
    scene.add(fireLight);

    // 2. Генерация леса (Случайные деревья)
    for(let i = 0; i < 20; i++) {
        const x = (Math.random() - 0.5) * 100;
        const z = (Math.random() - 0.5) * 100;
        // Не ставим деревья слишком близко к костру
        if (Math.sqrt(x*x + z*z) > 10) {
            loadModel('models/models_game/', 'tree', new THREE.Vector3(x, 0, z), 1.5 + Math.random());
        }
    }

    // 3. Большие деревья
    for(let i = 0; i < 10; i++) {
        const x = (Math.random() - 0.5) * 120;
        const z = (Math.random() - 0.5) * 120;
        if (Math.sqrt(x*x + z*z) > 15) {
            loadModel('models/models_game/', 'big_tree', new THREE.Vector3(x, 0, z), 2.5 + Math.random());
        }
    }

    // 4. Твои старые модели (тест)
    loadModel('models/models_game/', 'craft', new THREE.Vector3(3, 0, 3), 1.2);
    loadModel('models/models_animals/', 'wolf', new THREE.Vector3(-5, 0, -8), 1.3);

    // --- ПОЛ И ИГРОК (остальное без изменений) ---
    const ground = new THREE.Mesh(new THREE.PlaneGeometry(300, 300), new THREE.MeshStandardMaterial({ color: 0x2d4c1e }));
    ground.rotation.x = -Math.PI / 2;
    ground.receiveShadow = true;
    scene.add(ground);

    const player = new THREE.Group();
    const body = new THREE.Mesh(new THREE.BoxGeometry(0.6, 0.8, 0.3), new THREE.MeshStandardMaterial({color: 0x333333}));
    body.position.y = 1;
    player.add(body);
    scene.add(player);

    // ... (код управления W,A,S,D и анимации animate() оставляем прежним) ...
</script>
